{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bruno/OneDrive/Documentos/GitHub/react-gallery/components/Imagem.jsx"],"sourcesContent":["\"use client\";\r\nimport { useParams, useRouter, useSearchParams } from 'next/navigation';\r\nimport { useEffect, useState } from 'react';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport Image from 'next/image';\r\nimport Link from 'next/link';\r\nimport ImageZoom from 'react-image-zooom';\r\nimport useAuth from '@/hooks/useAuth'\r\n\r\nexport default function Imagem() {\r\n  const params = useParams();\r\n  const imageId = params?.imageId;\r\n  const [image, setImage] = useState(null);\r\n  const navigate = useRouter();\r\n  const [relatedImages, setRelatedImages] = useState([]);\r\n  const searchParams = useSearchParams();\r\n  const bgc = decodeURIComponent(searchParams.get(\"bgc\"));\r\n  const { logado } = useAuth();\r\n  const [confirmation, setConfirmation] = useState(false);\r\n  const [ren, setRen] = useState(false);\r\n  const [message, setMessage] = useState(false);\r\n\r\n  const slugify = (text) => {\r\n    return text\r\n      .normalize(\"NFD\")\r\n      .replace(/[\\u0300-\\u036f]/g, \"\")\r\n      .toLowerCase()\r\n      .trim()\r\n      .replace(/\\s+/g, \"-\")\r\n      .replace(/[^\\w-]+/g, \"\");\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!imageId) return;\r\n    const fetchImage = async () => {\r\n      const { data, error } = await supabase\r\n        .from('imagens')\r\n        .select('url, nome, categoria, id, width, height')\r\n        .eq('id', imageId)\r\n\r\n      if (error) {\r\n        console.error('Error fetching image:', error);\r\n        navigate.push('/');\r\n        return;\r\n      }\r\n      if (!error && data && data.length > 0) {\r\n        const comCor = data.map((img) => {\r\n          const paletteKey = `palette-${img.url}`;\r\n          const cachedPalette = localStorage.getItem(paletteKey);\r\n          const colors = cachedPalette ? JSON.parse(cachedPalette) : [\"#cccccc\"];\r\n          return { ...img, colors };\r\n        });\r\n        setImage(comCor[0]);\r\n      }\r\n    }\r\n\r\n    fetchImage();\r\n  }, [imageId]);\r\n\r\n  useEffect(() => {\r\n    if (!image) return;\r\n    const fetchRelated = async () => {\r\n      const { data, error } = await supabase.rpc(\"related_images_random\", {\r\n        p_categoria: image.categoria,\r\n        p_exclude_nome: image.nome,\r\n        p_id: image.id,\r\n        p_limit: 6,\r\n      });\r\n\r\n      if (!error && data) {\r\n        const enriched = data.map((img) => {\r\n          const paletteKey = `palette-${img.url}`;\r\n          const cachedPalette = localStorage.getItem(paletteKey);\r\n          const colors = cachedPalette ? JSON.parse(cachedPalette) : [\"#cccccc\"];\r\n          return { ...img, colors };\r\n        });\r\n\r\n        setRelatedImages(enriched);\r\n      }\r\n    };\r\n    fetchRelated();\r\n  }, [image]);\r\n\r\n  if (!image) return null;\r\n\r\n  return (\r\n    <div className=\"bg-gray-200 flex gap-5 flex-col-reverse xl:flex-row items-start justify-center relative h-full w-full mx-auto imagem z-50\">\r\n      <div className='flex flex-col xl:w-[40%] w-full items-center self-center'>\r\n        <div>\r\n          <h1 className='text-3xl font-semibold text-gray-900 mt-6 cl:mt-0 cl:text-left text-center'>{image.nome}</h1>\r\n          <h2 className='text-sm text-gray-600 cl:text-left text-center mt-1'>Categoria: {image.categoria}</h2>\r\n        </div>\r\n        <div className=\"mt-4 flex gap-4 xl:max-w-[600px] max-w-full z-50 flex-wrap p-12 place-self-center\">\r\n          {relatedImages.map((rel) => (\r\n            <div key={rel.nome} style={{ viewTransitionName: `figures-${rel.id.split('-')[0]}` }} className=\"bg-gray-300 w-32 cl:h-44 h-32 cursor-pointer overflow-hidden hover:[&_img]:[scale:1.05] [clip-path:url(#squircle-mask)] [-webkit-clip-path:url(#squircle-mask)]\"\r\n              onClick={() => navigate.push(`/${slugify(image.categoria)}/${rel.id}?bgc=${encodeURIComponent(rel.colors[0])}`)}>\r\n              <img src={rel.url} alt={rel.nome} className=\"w-full h-full object-cover duration-100 object-top\" />\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"z-10 relative xl:w-[60%] w-full min-h-dvh [view-transition-name:figure-img]\" data-image={image.nome}>\r\n        <Link href={`/${slugify(image.categoria)}`} style={{ \"--bg\": bgc }}\r\n          className={`bg-[--bg] text-lg cursor-pointer text-white absolute right-[unset] cl:right-12 cl:top-12 top-[unset] cl:bottom-unset bottom-20 cl:left-[unset] left-1/2 !z-50  rounded-full text-center leading-9 h-9 w-9`}>\r\n          X\r\n        </Link>\r\n\r\n        <ImageZoom\r\n          alt={image.nome}\r\n          src={image.url}\r\n          zoom={200}\r\n          fullWidth={true}\r\n          style={{ \"--shadow\": image.colors[0] + 66 }}\r\n          className={`[&_img]:mx-auto h-dvh w-full [&_img]:block [&_img]:h-dvh [&_img]:object-contain [&_img]:rounded-2xl [&_img]:!z-40 [&_img]:!w-auto [&_img]:!bg-transparent [&_img]:relative [&_img]:drop-shadow-[0_0_40px_var(--shadow)]`}\r\n        />\r\n        <Image\r\n          alt={image.nome}\r\n          src={image.url}\r\n          width={image.width}\r\n          height={image.height}\r\n          style={{ \"--shadow\": image.colors[0] + 66 }}\r\n          className={`mx-auto block h-dvh object-contain rounded-2xl !z-40 !w-auto !bg-transparent relative drop-shadow-[0_0_40px_var(--shadow)] cl:hidden`}\r\n\r\n        />\r\n        {logado &&\r\n          <>\r\n            <button className='absolute top-7 left-4 [&>svg_path]:fill-none [&>svg_path]:stroke-gray-800 duration-150 opacity-0 group-hover:opacity-100 z-50' onClick={() => setConfirmation(true)}>\r\n              <DeleteIcon />\r\n            </button>\r\n\r\n            <button className='absolute top-7 right-4 [&>svg_path]:fill-none [&>svg_path]:stroke-gray-800 duration-150 opacity-0 group-hover:opacity-100 z-50' onClick={() => { setConfirmation(true); setRen(true) }}>\r\n              <EditIcon />\r\n            </button>\r\n          </>\r\n        }\r\n        {confirmation && !ren &&\r\n          <div className='fixed bg-[#00000066] w-full h-[100dvh] top-0 left-0 z-[999999] grid place-items-center prompt'>\r\n            <div className='flex flex-col justify-center items-center bg-gray-200/30 backdrop-blur-md rounded-xl px-10 py-5 gap-4 max-w-[300px] w-[90%] border-gray-400/60 border-2 shadow-2xl'>\r\n              <h2 className='font-semibold text-gray-50'>TEM CERTEZA?</h2>\r\n              <div className='flex justify-center items-center gap-4'>\r\n                <button onClick={() => { handleDelete(url), setConfirmation(false) }} className='bg-black px-4 py-2 text-white text-sm rounded-lg'> DELETAR</button>\r\n                <button onClick={() => setConfirmation(false)} className='bg-white px-4 py-2 text-black text-sm rounded-lg'>CANCELAR</button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        }\r\n        {confirmation && ren &&\r\n          <div className='fixed bg-[#00000066] w-full h-[100dvh] top-0 left-0 z-[999999] grid place-items-center prompt'>\r\n            <div className='flex flex-col justify-center items-center bg-[#444a] rounded-xl px-10 py-5 gap-4 max-w-[300px] w-[90%] border-gray-400/60 border-2 shadow-2xl relative backdrop-blur-md'>\r\n              <button className='absolute right-2 top-0 text-white border-0 text-base z-50 cursor-pointer' onClick={() => setConfirmation(false)}>x</button>\r\n\r\n              {!message &&\r\n                <div className='flex justify-center items-center gap-4'>\r\n                  <input onBlur={(e) => e.target.value.length > 0 ? handleRename(e.target.value) : console.log('nada alterado')}\r\n                    placeholder={'NOVO NOME'}\r\n                    className='bg-white/30 px-4 py-2 text-white text-sm rounded-lg placeholder:text-gray-200'\r\n                  />\r\n                  <button\r\n                    onClick={() => {\r\n                      setUpWindow(true);\r\n                      setNova(true)\r\n                      localStorage.setItem('urlEditar', url);\r\n                    }}>\r\n                    <ReplaceIcon />\r\n                  </button>\r\n                </div>}\r\n              {message && <span>Renomeado com sucesso!</span>}\r\n            </div>\r\n          </div>\r\n        }\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}