{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bruno/OneDrive/Documentos/GitHub/react-gallery/components/Imagem.jsx"],"sourcesContent":["\"use client\";\r\nimport { useParams, useRouter, useSearchParams } from 'next/navigation';\r\nimport { useEffect, useState } from 'react';\r\nimport { supabase } from '@/lib/supabaseClient';\r\nimport Image from 'next/image';\r\nimport Link from 'next/link';\r\n\r\nexport default function Imagem() {\r\n  const params = useParams();\r\n  const imageId = params?.imageId;\r\n  const [image, setImage] = useState(null);\r\n  const navigate = useRouter();\r\n  const [relatedImages, setRelatedImages] = useState([]);\r\n  const searchParams = useSearchParams();\r\n  const bgc = decodeURIComponent(searchParams.get(\"bgc\"));\r\n\r\n  const slugify = (text) => {\r\n    return text\r\n      .normalize(\"NFD\")\r\n      .replace(/[\\u0300-\\u036f]/g, \"\")\r\n      .toLowerCase()\r\n      .trim()\r\n      .replace(/\\s+/g, \"-\")\r\n      .replace(/[^\\w-]+/g, \"\");\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!imageId) return;\r\n    const fetchImage = async () => {\r\n      const { data, error } = await supabase\r\n        .from('imagens')\r\n        .select('url, nome, categoria, id, width, height')\r\n        .eq('id', imageId)\r\n\r\n      if (error) {\r\n        console.error('Error fetching image:', error);\r\n        navigate.push('/');\r\n        return;\r\n      }\r\n      if (!error && data && data.length > 0) {\r\n        const comCor = data.map((img) => {\r\n          const paletteKey = `palette-${img.url}`;\r\n          const cachedPalette = localStorage.getItem(paletteKey);\r\n          const colors = cachedPalette ? JSON.parse(cachedPalette) : [\"#cccccc\"];\r\n          return { ...img, colors };\r\n        });\r\n        setImage(comCor[0]);\r\n      }\r\n    }\r\n\r\n    fetchImage();\r\n  }, [imageId]);\r\n\r\n  useEffect(() => {\r\n    if (!image) return;\r\n    const fetchRelated = async () => {\r\n      const { data, error } = await supabase.rpc(\"related_images_random\", {\r\n        p_categoria: image.categoria,\r\n        p_exclude_nome: image.nome,\r\n        p_id: image.id,\r\n        p_limit: 6,\r\n      });\r\n\r\n      if (!error && data) {\r\n        const enriched = data.map((img) => {\r\n          const paletteKey = `palette-${img.url}`;\r\n          const cachedPalette = localStorage.getItem(paletteKey);\r\n          const colors = cachedPalette ? JSON.parse(cachedPalette) : [\"#cccccc\"];\r\n          return { ...img, colors };\r\n        });\r\n\r\n        setRelatedImages(enriched);\r\n      }\r\n    };\r\n    fetchRelated();\r\n  }, [image]);\r\n\r\n  if (!image) return null;\r\n\r\n  return (\r\n    <div className=\"bg-gray-200 flex gap-5 flex-col-reverse xl:flex-row items-start justify-center relative h-full w-full mx-auto imagem z-50\">\r\n      <div className='flex flex-col xl:w-[40%] w-full items-center self-center'>\r\n        <div>\r\n          <h1 className='text-3xl font-semibold text-gray-900 mt-6 cl:mt-0 cl:text-left text-center'>{image.nome}</h1>\r\n          <h2 className='text-sm text-gray-600 cl:text-left text-center mt-1'>Categoria: {image.categoria}</h2>\r\n        </div>\r\n        <div className=\"mt-4 flex gap-4 xl:max-w-[600px] max-w-full z-50 flex-wrap p-12 place-self-center\">\r\n          {relatedImages.map((rel) => (\r\n            <div key={rel.nome} style={{ viewTransitionName: `figures-${rel.id.split('-')[0]}` }} className=\"bg-gray-300 w-32 cl:h-44 h-32 cursor-pointer overflow-hidden hover:[&_img]:[scale:1.05] [clip-path:url(#squircle-mask)] [-webkit-clip-path:url(#squircle-mask)]\"\r\n              onClick={() => navigate.push(`/${slugify(image.categoria)}/${rel.id}?bgc=${encodeURIComponent(rel.colors[0])}`)}>\r\n              <img src={rel.url} alt={rel.nome} className=\"w-full h-full object-cover duration-100 object-top\" />\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"z-10 relative xl:w-[60%] w-full min-h-dvh [view-transition-name:figure-img]\" data-image={image.nome}>\r\n        <Link href={`/${slugify(image.categoria)}`} style={{ \"--bg\": bgc }}\r\n          className={`bg-[--bg] leading-none text-lg cursor-pointer text-white absolute right-[unset] cl:right-12 cl:top-12 top-[unset] cl:bottom-unset bottom-20 cl:left-[unset] left-1/2 !z-50  rounded-full text-center leading-9 h-9 w-9`}>\r\n          X\r\n        </Link>\r\n\r\n        <Image\r\n          alt={image.nome}\r\n          width={image.width || 800}\r\n          height={image.height || 600}\r\n          src={image.url}\r\n          style={{ \"--shadow\": image.colors[0] + 66 }}\r\n          className={`mx-auto block h-dvh object-contain rounded-2xl !z-40 !w-auto duration-100 !bg-transparent relative drop-shadow-[0_0_40px_var(--shadow)]`} />\r\n      </div>\r\n    </div>\r\n  );\r\n}"],"names":[],"mappings":"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"}}]
}