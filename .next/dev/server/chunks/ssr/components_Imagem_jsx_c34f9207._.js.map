{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Bruno/OneDrive/Documentos/GitHub/react-gallery/components/Imagem.jsx"],"sourcesContent":["\"use client\";\nimport { useParams, useRouter, useSearchParams } from 'next/navigation';\nimport { useEffect, useState } from 'react';\nimport { supabase } from '@/lib/supabaseClient';\nimport Image from 'next/image';\n\nexport default function Imagem() {\n  const params = useParams();\n  const imageId = params?.imageId;\n  const [image, setImage] = useState(null);\n  const navigate = useRouter();\n  const [relatedImages, setRelatedImages] = useState([]);\n  const searchParams = useSearchParams();\n  const bgc = decodeURIComponent(searchParams.get(\"bgc\"));\n\n  const slugify = (text) => {\n    return text\n      .normalize(\"NFD\")\n      .replace(/[\\u0300-\\u036f]/g, \"\")\n      .toLowerCase()\n      .trim()\n      .replace(/\\s+/g, \"-\")\n      .replace(/[^\\w-]+/g, \"\");\n  }\n\n  useEffect(() => {\n    if (!imageId) return;\n    const fetchImage = async () => {\n      const { data, error } = await supabase\n        .from('imagens')\n        .select('url, nome, categoria, id, width, height')\n        .eq('id', imageId)\n\n      if (error) {\n        console.error('Error fetching image:', error);\n        navigate.push('/');\n        return;\n      }\n      if (!error && data && data.length > 0) {\n        const comCor = data.map((img) => {\n          const paletteKey = `palette-${img.url}`;\n          const cachedPalette = localStorage.getItem(paletteKey);\n          const colors = cachedPalette ? JSON.parse(cachedPalette) : [\"#cccccc\"];\n          return { ...img, colors };\n        });\n        setImage(comCor[0]);\n      }\n    }\n\n    fetchImage();\n  }, [imageId]);\n\n  useEffect(() => {\n    if (!image) return;\n    const fetchRelated = async () => {\n      const { data, error } = await supabase.rpc(\"related_images_random\", {\n        p_categoria: image.categoria,\n        p_exclude_nome: image.nome,\n        p_id: image.id,\n        p_limit: 6,\n      });\n\n      if (!error && data) {\n        const enriched = data.map((img) => {\n          const paletteKey = `palette-${img.url}`;\n          const cachedPalette = localStorage.getItem(paletteKey);\n          const colors = cachedPalette ? JSON.parse(cachedPalette) : [\"#cccccc\"];\n          return { ...img, colors };\n        });\n\n        setRelatedImages(enriched);\n      }\n    };\n    fetchRelated();\n  }, [image]);\n\n  const handleClose = () => {\n    const targetPath = `/${slugify(image.categoria)}`;\n    navigate.push(targetPath);\n  };\n\n  console.log(image);\n\n  if (!image) return null;\n\n  return (\n    <div className=\"bg-gray-200 flex gap-5 flex-col-reverse xl:flex-row items-start justify-center relative h-full w-full mx-auto imagem z-50\">\n      <div className='flex flex-col xl:w-[40%] w-full items-center self-center'>\n        <div>\n          <h1 className='text-3xl font-semibold text-gray-900 mt-6 cl:mt-0 cl:text-left text-center'>{image.nome}</h1>\n          <h2 className='text-sm text-gray-600 cl:text-left text-center mt-1'>Categoria: {image.categoria}</h2>\n        </div>\n        <div className=\"mt-4 flex gap-4 xl:max-w-[600px] max-w-full z-50 flex-wrap p-12 place-self-center\">\n          {relatedImages.map((rel) => (\n            <div key={rel.nome} style={{ viewTransitionName: `figures-${rel.id.split('-')[0]}` }} className=\"bg-gray-300 w-32 cl:h-44 h-32 cursor-pointer overflow-hidden hover:[&_img]:[scale:1.05] [clip-path:url(#squircle-mask)] [-webkit-clip-path:url(#squircle-mask)]\"\n              onClick={() => navigate.push(`/${slugify(image.categoria)}/${rel.id}?bgc=${encodeURIComponent(rel.colors[0])}`)}>\n              <img src={rel.url} alt={rel.nome} className=\"w-full h-full object-cover duration-100 object-top\" />\n            </div>\n          ))}\n        </div>\n      </div>\n\n      <div className=\"z-10 relative xl:w-[60%] w-full min-h-dvh [view-transition-name:figure-img]\" data-image={image.nome}>\n        <button style={{ background: bgc, viewTransitionName: `figure-caption` }} className={`leading-none text-lg cursor-pointer text-white absolute right-[unset] cl:right-12 cl:top-12 top-[unset] cl:bottom-unset bottom-20 cl:left-[unset] left-1/2 z-50  rounded-full p-2 h-8 w-8`}\n          onClick={handleClose}>X</button>\n        <Image\n          alt={image.nome}\n          width={image.width || 800}\n          height={image.height || 600}\n          src={image.url}\n          style={{ \"--shadow\": image.colors[0] + 66 }}\n          className={`mx-auto cl:!block !hidden h-dvh object-contain rounded-2xl !z-40 !w-auto duration-100 !bg-transparent relative drop-shadow-[0_0_40px_var(--shadow)]`} />\n      </div>\n    </div>\n  );\n}"],"names":[],"mappings":"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"}}]
}